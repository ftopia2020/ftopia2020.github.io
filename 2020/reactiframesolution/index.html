<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noodp"/>
    <meta name="author" content="Faye.Fei">
    <meta name="description" content="个人技术博客">
    <meta name="keywords" content="ftopia fei">
    
    <link rel="prev" href="https://ftopia2020.github.io/2020/ssl/" />
    <link rel="next" href="https://ftopia2020.github.io/2020/gitbranchrule/" />
    <link rel="canonical" href="https://ftopia2020.github.io/2020/reactiframesolution/" />
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <link href="//use.fontawesome.com/releases/v5.9.0/css/all.css" rel="stylesheet">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <title>
         
         
             React&#43; iframe 子窗体更新父窗体地址栏的解决方案 | Ftopia
         
    </title>
    <meta name="title" content="React&#43; iframe 子窗体更新父窗体地址栏的解决方案 | Ftopia">
      
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


    
    
 

<script type="application/ld+json">
{   "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/ftopia2020.github.io\/"
    },
    "articleSection" : "posts",
    "name" : "React\x2b iframe 子窗体更新父窗体地址栏的解决方案",
    "headline" : "React\x2b iframe 子窗体更新父窗体地址栏的解决方案",
    "description" : "WHY iframe 提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离等问题统统都能被完美解决。 所以，如果我们希望集成多个站点，iframe 不失为实现 微",
    "inLanguage" : "en-us",
    "author" : "me",
    "creator" : "me",
    "publisher": "me",
    "accountablePerson" : "me",
    "copyrightHolder" : "me",
    "copyrightYear" : "2020",
    "datePublished": "2020-06-19 00:00:00 \x2b0000 UTC",
    "dateModified" : "2020-06-19 00:00:00 \x2b0000 UTC",
    "url" : "https:\/\/ftopia2020.github.io\/2020\/reactiframesolution\/",
    "wordCount" : "677",
    "keywords" : [ "react","iframe","跨域","原创", "Ftopia"]
}
</script>

  </head>
  
    
  
  
<aside class="side-toc">
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#why">WHY</a></li>
    <li><a href="#how">HOW</a>
      <ul>
        <li><a href="#跨域-同域">跨域 =》同域</a></li>
        <li><a href="#监听子窗体">监听子窗体</a></li>
      </ul>
    </li>
  </ul>
</nav>
</aside>

  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    
    <div class="top-scroll-bar"></div>
    
    <div class="container">
        <div class="navbar-header header-logo">
            <a href="https://ftopia2020.github.io/" style="margin-left: 20px">
                <img src="/favicon-32x32.png" style="width: 16px;" />
                <span> Ftopia </span>

            </a>
        </div>
        <div class="menu navbar-right">
            
            
            <a class="menu-item"
                href="/posts/" title="">Blog</a>
            
            <a class="menu-item"
                href="/categories/" title="">Categories</a>
            
            <a class="menu-item"
                href="/tags/" title="">Tags</a>
            
            <a class="menu-item"
                href="/about/" title="">About</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-fw"></i></a>
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
    
    <div class="top-scroll-bar"></div>
    
    <div class="container">
        <div class="navbar-header">
            <div> <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a
                    href="https://ftopia2020.github.io/">Ftopia</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>

        <div class="menu" id="mobile-menu">
            
            
            <a class="menu-item"
                href="/posts/" title="">Blog</a>
            
            <a class="menu-item"
                href="/categories/" title="">Categories</a>
            
            <a class="menu-item"
                href="/tags/" title="">Tags</a>
            
            <a class="menu-item"
                href="/about/" title="">About</a>
            
        </div>
    </div>
</nav>
        
        <div id="landlord">
          <div class="message" style="opacity:0"></div>
          <canvas id="live2d" width="280" height="250" class="live2d"></canvas>
          <div class="hide-button">Bye ~</div>
       </div>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">React&#43; iframe 子窗体更新父窗体地址栏的解决方案</h1>
        <div class="post-meta">

            <i class="far fa-folder-open"></i>
            <span class="post-category">
                
            </span>
            &nbsp;
            By me ♥
            &nbsp;
            <span class="post-time">
                <i class="far fa-calendar-alt"></i>
                <time datetime=2020-06-19
                    itemprop="datePublished">
                    2020-06-19</time>
            </span>
            &nbsp;
            <i class="far fa-file-word"></i> <span class="post-word-count"> 677 字</span>
            &nbsp;
            <i class="far fa-clock"></i> <span class="more-meta"> 2 分钟</span>

        </div>
    </header>
    <div class="post-content">
        

        
        
        

        
        

        
        
        

        
        
        

        <h2 id="why">WHY</h2>
<p>iframe 提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离等问题统统都能被完美解决。</p>
<p>所以，如果我们希望集成多个站点，iframe 不失为实现 <a href="https://www.google.com.hk/search?q=%E5%BE%AE%E5%89%8D%E7%AB%AF">微前端</a> 的一种简单方式。</p>
<p>但是，url 不同步会是个比较头疼的问题。举个例子，iframe 子窗体内触发 src 变更后，地址栏不会跟随变更。如果用户刷新，则仍会回到之前的页面，比如：</p>
<p><a href="https://vf66l.csb.app/">示例</a> 如下，子窗体引入了百度页面，搜索某关键字后跳转结果页，但是刷新后仍会是百度首页。</p>
<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="http://image.ftopia.cn/blog/reactIFrameSolution.png" alt="reactIFrameSolution" class="lazyload"><figcaption class="image-caption">reactIFrameSolution</figcaption></figure></p>
<h2 id="how">HOW</h2>
<p>上例的百度站点不同域，我们无法做到改变父窗体地址栏。但，若是自有站点，子窗体同域，我们可以通过代码实现更新父窗体地址栏，这样可变相解决 URL不同步等操作父窗体的问题。解决方案参考如下：</p>
<h3 id="跨域-同域">跨域 =》同域</h3>
<p>通常自有站点可接受多个二级域名，如 image.baidu.com 和 zhidao.baidu.com；默认 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/domain">document.domain</a> 是不同的，但我们可 js 设置 <code>document.domain = baidu.com</code> 来实现同域。</p>
<blockquote>
<p>前提条件：这两个域名必须属于同一个基础域名，且所用的协议，端口都要一致</p>
<p>出于对安全性的考虑，而禁止两个或者多个不同域的页面进行互相操作。</p>
<p>相同域的页面在相互操作的时候不会有任何问题。</p>
</blockquote>
<h3 id="监听子窗体">监听子窗体</h3>
<p>直接上代码，参考如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tsx" data-lang="tsx">
<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span>, { <span style="color:#a6e22e">useState</span>, <span style="color:#a6e22e">useRef</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;

<span style="color:#a6e22e">type</span> <span style="color:#a6e22e">Func</span> <span style="color:#f92672">=</span> (...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">any</span>[]) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">any</span>;

<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">SubIFrameProps</span> {
    <span style="color:#a6e22e">suburl</span>: <span style="color:#66d9ef">string</span>;
    <span style="color:#a6e22e">checkPathForMenu</span>: <span style="color:#66d9ef">Func</span>;
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">SubIFrame</span>: <span style="color:#66d9ef">React.FunctionComponent</span>&lt;<span style="color:#f92672">SubIFrameProps</span>&gt; <span style="color:#f92672">=</span> (<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">SubIFrameProps</span>) <span style="color:#f92672">=&gt;</span> {

    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">iFrameHeight</span>, <span style="color:#a6e22e">SetIFrameHeight</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#e6db74">&#39;0px&#39;</span>);

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">iframeEl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useRef</span>(<span style="color:#66d9ef">null</span>);

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">replaceParentURL</span>(<span style="color:#a6e22e">href</span>:<span style="color:#66d9ef">string</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">href</span>);
        <span style="color:#75715e">//do sth. e.g. window.history.pushState( ... )  
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//props.checkPathForMenu(href);
</span><span style="color:#75715e"></span>    }

    <span style="color:#66d9ef">return</span> (
        &lt;<span style="color:#f92672">iframe</span>
            <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;subapp-iframe&#34;</span>
            <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;100%&#39;</span>, <span style="color:#a6e22e">height</span>: <span style="color:#66d9ef">iFrameHeight</span>, <span style="color:#a6e22e">overflow</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;visible&#39;</span> }}
            <span style="color:#a6e22e">onLoad</span><span style="color:#f92672">=</span>{() <span style="color:#f92672">=&gt;</span> {
                <span style="color:#a6e22e">SetIFrameHeight</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span>window.<span style="color:#a6e22e">innerHeight</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px`</span>);
                <span style="color:#66d9ef">try</span> {
                  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentIFrameWindow</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">iframeEl</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">any</span>).<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">contentWindow</span>;
                  <span style="color:#a6e22e">currentIFrameWindow</span>.window.<span style="color:#a6e22e">onhashchange</span> <span style="color:#f92672">=</span> () <span style="color:#f92672">=&gt;</span> {
                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentVmHref</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">currentIFrameWindow</span>.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>;
                    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;currentVmHref: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">currentVmHref</span>);
                    <span style="color:#a6e22e">replaceParentURL</span>(<span style="color:#a6e22e">currentVmHref</span>);
                  };
                } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
                  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">error</span>);
                }
            }}
            <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;subAPP&#34;</span>
            <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">iframeEl</span>}
            <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">suburl</span>}
            <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100%&#34;</span>
            <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">iFrameHeight</span>}
            <span style="color:#a6e22e">scrolling</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no&#34;</span>
            <span style="color:#a6e22e">frameBorder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
        /&gt;
    );
}


<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">SubIFrame</span>;
</code></pre></div><p>列出相关的点：</p>
<ul>
<li>iframe onload 处理 iframe 载入事件</li>
<li>react hooks useRef 关联 iframe（低版本 react 写法会不同）</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onhashchange">window.onhashchange</a> 监听子窗体更改</li>
<li>扩展：如代码中 <code>props.checkPathForMenu</code>  方法的调用可实现父窗体函数（笔者站点实现更改菜单选中项）</li>
</ul>
<blockquote>
<p>有关 iframe 样式的更改可参考：<a href="/2019/iframe/">如何在页面中优雅地内嵌 iframe ？</a></p>
</blockquote>

    </div>

    <div class="post-copyright">
        
        <p class="copyright-item">
            <span>Author:</span>
            <span>Faye.Fei </span>
        </p>
        

        
        <p class="copyright-item">
            <span>Link:</span>
            <a href=https://ftopia2020.github.io/2020/reactiframesolution/>https://ftopia2020.github.io/2020/reactiframesolution/</span>
        </p>
        
        
        <p class="copyright-item lincese">
            本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
        </p>
        
    </div>


    <div class="post-tags">
        
        <section>
            <i class="iconfont icon-tag"></i>Tag(s):
            
            <span class="tag"><a href="https://ftopia2020.github.io/tags/react/">
                    #react</a></span>
            
            <span class="tag"><a href="https://ftopia2020.github.io/tags/iframe/">
                    #iframe</a></span>
            
            <span class="tag"><a href="https://ftopia2020.github.io/tags/%E8%B7%A8%E5%9F%9F/">
                    #跨域</a></span>
            
            <span class="tag"><a href="https://ftopia2020.github.io/tags/%E5%8E%9F%E5%88%9B/">
                    #原创</a></span>
            
        </section>
        
        <section>
            <a href="javascript:window.history.back();">back</a></span> ·
            <span><a href="https://ftopia2020.github.io/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://ftopia2020.github.io/2020/ssl/" class="prev" rel="prev" title="【转】一篇文章让你搞懂 SSL 证书"><i
                class="iconfont icon-left"></i>&nbsp;【转】一篇文章让你搞懂 SSL 证书</a>
        
        
        <a href="https://ftopia2020.github.io/2020/gitbranchrule/" class="next" rel="next"
            title="【转】您必须知道的 Git 分支开发规范">【转】您必须知道的 Git 分支开发规范&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
        
        
        
        <span id="/2020/reactiframesolution/" class="leancloud_visitors" data-flag-title="React&#43; iframe 子窗体更新父窗体地址栏的解决方案">
            <span class="post-meta-item-text">访问量 </span>
            <span class="leancloud-visitors-count"></span>
            <p></p>
        </span>
        <div id="vcomments"></div>
        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
        <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
        <script type="text/javascript">
            new Valine({
                el: '#vcomments',
                appId: 'QzPcfvLVz747mNHBkSQSSoQ8-gzGzoHsz',
                appKey: 'qQnhWMSodU0tlOPBVBSYznVU',
                notify:  false ,
                verify:  false ,
                avatar: 'mp',
                placeholder: '说点什么吧...',
                visitor:  true 
             });
        </script>
        
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2020 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://ftopia2020.github.io/">Faye.Fei</a> </span> 
         
         <br />
         
            <a href="http://beian.miit.gov.cn/" target="_blank" rel="external nofollow">沪ICP备18041231号 </a> |
         
		  <span>
           Powered by
           <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a>
         </span> 
      </div>
</footer>














<script type="text/javascript">
    var message_Path = "/live2d/"
    var home_Path = "https://ftopia2020.github.io/"  
</script>


    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    



     </div>
  
  </body>
</html>
